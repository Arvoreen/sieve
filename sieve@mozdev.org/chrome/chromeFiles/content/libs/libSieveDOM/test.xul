<?xml version="1.0" encoding="utf-8"?>

<?xml-stylesheet href="./xbl/test.css" type="text/css"?>
<?xml-stylesheet href="chrome://global/skin/" type="text/css"?>

<window xmlns:html="http://www.w3.org/1999/xhtml"
    xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
    onload="init();">
  <html:style>

#trash 
{
  height: 80px;
  width:80px;
  background-color:transparent;   
  background-image:url('48px-User-trash.svg.png');
  background-repeat:no-repeat;
  background-position:center center;   
  
} 
 
#trash[sivDragging="true"] 
{
  background-image:url('48px-User-trash-full.svg.png');
} 
   
.SivElementBlock {
  padding-left: 20px;
}
    
.SivElement {
  background-color: -moz-dialog;
  background-image: -moz-linear-gradient(rgba(255,255,255,.25), rgba(0,0,0,.15));
  color: -moz-dialogText;
  margin: 1px;
  -moz-border-radius: 2px;

  margin-left: auto;
  margin-right: auto;
  width:600px;
  border: 1px solid #000066;
 
/*  background-color: hsl(219,45%,60%);*/
/*  background-color: hsl(92,45%,52%);*/
}

.SivFocusedElement {
  background-color: -moz-dialog;
  background-image: -moz-linear-gradient(rgba(255,255,255,.25), rgba(0,0,0,.15));
  color: -moz-dialogText;
  margin: 1px;
  -moz-border-radius: 2px;

  margin-left: auto;
  margin-right: auto;
  width:600px;
  border: 1px solid #000066;

  background-color: hsl(92,45%,52%);
}

.SivElement:hover {
background-image: -moz-linear-gradient(rgba(255,255,255,.5), rgba(50%,50%,50%,.2), rgba(0,0,0,.15));
  /* selected...
  background-image: -moz-linear-gradient(rgba(0,0,0,.4), rgba(0,0,0,.1));*/
}

</html:style>

<script src="./xbl/SieveXBLHelper.js" type="text/javascript" />

<script src="SieveLexer.js" type="text/javascript" />

<script src="./RFC3028/SieveImports.js" type="text/javascript" />

<script src="./RFC3028/SieveActions.js" type="text/javascript" />

<script src="./RFC3028/SieveBlocks.js" type="text/javascript" />

<script src="SieveAtoms.js" type="text/javascript" />

<script src="./RFC3028/SieveWhiteSpaces.js" type="text/javascript" />

<script src="./RFC3028/SieveStrings.js" type="text/javascript" />

<script src="SieveScriptDOM.js" type="text/javascript" />

<script src="SieveXULHelper.js" type="text/javascript"/>

<script src="SieveImapFlags.js" type="text/javascript" />

<script src="./RFC3028/SieveConditions.js" type="text/javascript" />

<script src="./RFC3028/SieveTests.js" type="text/javascript" />


<script type="text/javascript">

var dom  = new SieveDom();

function parse()
{  
    var str = document.getElementById("txtScript").value;  

    dom.setScript(str);
        
    document.getElementById("txtOutput").value = dom.toString();
    
    document.getElementById("divOutput").innerHTML =  " ";
    document.getElementById("divOutput").appendChild(dom.toXUL());   
}

function update()
{
  document.getElementById("txtOutput").value = dom.toString();
}

  function init()
  {
    // TODO Use create Drop target instead...
    // ... and pass a listener for changing the icon...
  /*  var elm = document.getElementById("trash");
 
     elm.addEventListener("dragenter", 
       function (event) {          
        document.getElementById("trash").setAttribute("src","48px-User-trash-full.svg.png");
        //alert(document.getElementById("trash").getAttribute("sivAcceptDrop"));
      },
      true);

    elm.addEventListener("dragexit",
      function (event) {
        document.getElementById("trash").setAttribute("src","48px-User-trash.svg.png");
        //alert(document.getElementById("trash").getAttribute("sivAcceptDrop"));
      },
      true);

    elm.addEventListener("dragdrop",
      function (event) {
        document.getElementById("trash").setAttribute("src","48px-User-trash.svg.png");
      },
      true);*/
/*    var elm = document.getElementById("trash");

    elm.addEventListener("dragenter", 
      function (event) {
        if ( !event.dataTransfer.mozGetDataAt('sieve/action',0))
          return;
          
        document.getElementById("trash").setAttribute("src","48px-User-trash-full.svg.png");
      },
      true);
        
    elm.addEventListener("dragexit",
      function (event) {
        if ( !event.dataTransfer.mozGetDataAt('sieve/action',0))
          return;
        
        document.getElementById("trash").setAttribute("src","48px-User-trash.svg.png");
      },
      true);
        
    elm.addEventListener("dragover",
      function (event) { 
        if ( !event.dataTransfer.mozGetDataAt('sieve/action',0))
          return;

        event.stopPropagation(); 
        event.preventDefault();
      },
      true);
        
    elm.addEventListener("dragdrop",
      function (event) {
        if ( !event.dataTransfer.mozGetDataAt('sieve/action',0))
          return; 
        
        document.getElementById("trash").setAttribute("src","48px-User-trash.svg.png");
  
        var source = event.dataTransfer.mozGetDataAt('sieve/action',0);
        source.parentNode.removeChild(source);  
  
        source = event.dataTransfer.mozGetDataAt('sieve/action',1);
        source.parentNode.removeChild(source);
        
        dom.removeElement(
             event.dataTransfer.mozGetDataAt('sieve/action',2));
        
        event.stopPropagation();          
      },
      true);*/    
  }

</script>
<vbox>
  <label value="Input:" />
  <textbox id="txtScript" cols="50" rows="10"  multiline="true" />
  <spacer />
  <hbox>
    <button label="Parse Sieve Script" onclick="parse()" />
    <button label="Update Sieve Script" onclick="update()" />
  </hbox>
  <spacer />
  <label value="Result:" />
  <textbox id="txtOutput" cols="50" rows="10"  multiline="true" readonly="readonly"/>
  <spacer />
</vbox>
<hbox flex="1">    
  <vbox>
    <spacer flex="1" />
    <sivDropTarget id="trash" />
  </vbox>
  <vbox flex="1" />
  <vbox id="divOutput" style="background-color:gray;overflow-y: scroll;"  />
  <vbox  flex="1" />
</hbox>  
</window>
